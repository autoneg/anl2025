
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://yasserfarouk.github.io/anl2025tmp/tutorials/tutorial_develop/">
      
      
        <link rel="prev" href="../Tutorial_run_a_negotiation/">
      
      
        <link rel="next" href="../tutorial_scenarios/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Develop a new negotiator - ANL 2025 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#anl-2025-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ANL 2025 Documentation" class="md-header__button md-logo" aria-label="ANL 2025 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ANL 2025 Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Develop a new negotiator
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ANL 2025 Documentation" class="md-nav__button md-logo" aria-label="ANL 2025 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ANL 2025 Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorial_run_a_negotiation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running a negotiation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Develop a new negotiator
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Develop a new negotiator
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#developing-a-negotiator" class="md-nav__link">
    <span class="md-ellipsis">
      Developing a negotiator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Developing a negotiator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-the-agent-in-a-single-session" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the agent in a single session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-agent-in-a-tournament" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the agent in a tournament
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-of-multideal-scenarios-in-anl-2025" class="md-nav__link">
    <span class="md-ellipsis">
      Types of multideal scenarios in ANL 2025
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#available-helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Available helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters-of-propose-and-respond" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters of propose and respond
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-acceptancd-strategy-response" class="md-nav__link">
    <span class="md-ellipsis">
      The acceptancd strategy (response)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-bidding-offering-strategy-propose" class="md-nav__link">
    <span class="md-ellipsis">
      The bidding (offering) strategy (propose)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties-available-from-the-undelying-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Properties available from the undelying Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties-and-methods-available-through-the-nmi" class="md-nav__link">
    <span class="md-ellipsis">
      Properties and methods available through the NMI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-available-through-the-utility-function" class="md-nav__link">
    <span class="md-ellipsis">
      Tools available through the utility function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Other Callbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-our-random-negotiator" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding our random negotiator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-more-meaningful-negotiator" class="md-nav__link">
    <span class="md-ellipsis">
      A more meaningful negotiator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A more meaningful negotiator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construction" class="md-nav__link">
    <span class="md-ellipsis">
      Construction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overall-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Overall Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opponent-modeling-estimating-reserved-value" class="md-nav__link">
    <span class="md-ellipsis">
      Opponent Modeling (Estimating Reserved Value)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceptance-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Acceptance Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bidding-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Bidding Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-a-single-negotiation" class="md-nav__link">
    <span class="md-ellipsis">
      Running a single negotiation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Other Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note-about-running-tournaments" class="md-nav__link">
    <span class="md-ellipsis">
      Note about running tournaments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_scenarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualize scenarios
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#developing-a-negotiator" class="md-nav__link">
    <span class="md-ellipsis">
      Developing a negotiator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Developing a negotiator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-the-agent-in-a-single-session" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the agent in a single session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-agent-in-a-tournament" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the agent in a tournament
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-of-multideal-scenarios-in-anl-2025" class="md-nav__link">
    <span class="md-ellipsis">
      Types of multideal scenarios in ANL 2025
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#available-helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Available helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters-of-propose-and-respond" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters of propose and respond
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-acceptancd-strategy-response" class="md-nav__link">
    <span class="md-ellipsis">
      The acceptancd strategy (response)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-bidding-offering-strategy-propose" class="md-nav__link">
    <span class="md-ellipsis">
      The bidding (offering) strategy (propose)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties-available-from-the-undelying-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Properties available from the undelying Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties-and-methods-available-through-the-nmi" class="md-nav__link">
    <span class="md-ellipsis">
      Properties and methods available through the NMI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-available-through-the-utility-function" class="md-nav__link">
    <span class="md-ellipsis">
      Tools available through the utility function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Other Callbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-our-random-negotiator" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding our random negotiator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-more-meaningful-negotiator" class="md-nav__link">
    <span class="md-ellipsis">
      A more meaningful negotiator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A more meaningful negotiator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construction" class="md-nav__link">
    <span class="md-ellipsis">
      Construction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overall-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Overall Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opponent-modeling-estimating-reserved-value" class="md-nav__link">
    <span class="md-ellipsis">
      Opponent Modeling (Estimating Reserved Value)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceptance-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Acceptance Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bidding-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Bidding Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-a-single-negotiation" class="md-nav__link">
    <span class="md-ellipsis">
      Running a single negotiation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Other Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note-about-running-tournaments" class="md-nav__link">
    <span class="md-ellipsis">
      Note about running tournaments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="anl-2025-tutorial">ANL 2025 Tutorial</h1>
<h2 id="developing-a-negotiator">Developing a negotiator</h2>
<p>The agents for the ANL competition are simple extensions of <a href="https://yasserfarouk.github.io/negmas">NegMAS</a> negotiators. As such, they can be developed using any approach used to develop negotiators in NegMAS.</p>
<p>To develop a negotiator, you need to inherit from the <a href="http://www.yasserm.com/anl2025tmp/reference/#anl2025.negotiator.ANL2025Negotiator">ANL2025Negotiator</a> class and implement the <a href="http://www.yasserm.com/anl2025tmp/reference/#anl2025.negotiator.ANL2025Negotiator.propose"><code>propose()</code></a> and <a href="http://www.yasserm.com/anl2025tmp/reference/#anl2025.negotiator.ANL2025Negotiator.respond"><code>respond()</code></a>.</p>
<p>Here is a simple random negotiator:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">negmas</span><span class="w"> </span><span class="kn">import</span> <span class="n">Outcome</span><span class="p">,</span> <span class="n">ResponseType</span><span class="p">,</span> <span class="n">SAOState</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">anl2025</span><span class="w"> </span><span class="kn">import</span> <span class="n">ANL2025Negotiator</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyRandom2025</span><span class="p">(</span><span class="n">ANL2025Negotiator</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">p_end</span> <span class="o">=</span> <span class="mf">0.0003</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">p_reject</span> <span class="o">=</span> <span class="mf">0.999</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propose</span><span class="p">(</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">negotiator_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">SAOState</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Outcome</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">nmi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiators</span><span class="p">[</span><span class="n">negotiator_id</span><span class="p">]</span><span class="o">.</span><span class="n">negotiator</span><span class="o">.</span><span class="n">nmi</span>        
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">nmi</span><span class="o">.</span><span class="n">outcome_space</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">respond</span><span class="p">(</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">negotiator_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">SAOState</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResponseType</span><span class="p">:</span>        
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_end</span><span class="p">:</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>            <span class="k">return</span> <span class="n">ResponseType</span><span class="o">.</span><span class="n">END_NEGOTIATION</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>            <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_reject</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>            <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">current_offer</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="o">.</span><span class="n">reserved_value</span>  <span class="c1"># type: ignore</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>        <span class="p">):</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>            <span class="k">return</span> <span class="n">ResponseType</span><span class="o">.</span><span class="n">REJECT_OFFER</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        <span class="k">return</span> <span class="n">ResponseType</span><span class="o">.</span><span class="n">ACCEPT_OFFER</span>
</span></code></pre></div>
<h3 id="testing-the-agent-in-a-single-session">Testing the agent in a single session</h3>
<p>The <code>anl2025</code> package provide two functions for running single multi-deal negotiation sessions:
1. <code>run_generated_session</code>  which runs a randomly generated session with some control over the types of negotiators for the center and edges as well as the utility functions used.
2. <code>run_session</code> which runs a session with some predefined <code>MultidealScenario</code>.</p>
<p>Both functions return a <code>SessionResults</code> object which allows you to access the following values after the session is completed:</p>
<ol>
<li><code>mechanisms</code> pointing to one <a href="https://negmas.readthedocs.io/en/latest/api/negmas.sao.SAOMechanism.html#saomechanism">SAOMechanism</a> for each negotiation thread.</li>
<li><code>center_negotiator</code> pointing to a <a href="reference/#anl2025.negotiator.ANL2025Negotiator">ANL2025Negotiator</a> for the center negotiator.</li>
<li><code>edge_negotiators</code> pointing to a list of <a href="https://negmas.readthedocs.io/en/latest/api/negmas.sao.SAONegotiator.html#saonegotiator">SAONegotiators</a> for the edge negotiators.</li>
<li><code>center_utility</code> giving the utility value received by the center negotiator</li>
<li><code>edge_utility</code> giving the utility value received by each edge negotiator.</li>
</ol>
<p>Here is an example of running a session with our random negotiator against 3 edges on a randomly generated session.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">anl2025</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_generated_session</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">results</span> <span class="o">=</span> <span class="n">run_generated_session</span><span class="p">(</span><span class="n">center_type</span><span class="o">=</span><span class="n">MyRandom2025</span><span class="p">,</span> <span class="n">nedges</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Center Utility: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">center_utility</span><span class="si">}</span><span class="se">\n</span><span class="s2">Edge Utilities: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">edge_utilities</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Center Utility: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.3870387152920761</span>
Edge Utilities: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.6177914447353527</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.9891125180017052</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.7858556439249424</span><span style="font-weight: bold">]</span>
</pre>

<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_3_1.png" /></p>
<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_3_2.png" /></p>
<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_3_3.png" /></p>
<p>We can achieve the same result by first creating a scenario and then running the session:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">anl2025</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_multideal_scenario</span><span class="p">,</span> <span class="n">run_session</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">scenario</span> <span class="o">=</span> <span class="n">make_multideal_scenario</span><span class="p">(</span><span class="n">nedges</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">results</span> <span class="o">=</span> <span class="n">run_session</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">center_type</span><span class="o">=</span><span class="n">MyRandom2025</span><span class="p">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Center Utility: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">center_utility</span><span class="si">}</span><span class="se">\n</span><span class="s2">Edge Utilities: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">edge_utilities</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Center Utility: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4421613897641405</span>
Edge Utilities: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.8037297701310387</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.672045382805366</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.849260661774922</span><span style="font-weight: bold">]</span>
</pre>

<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_5_1.png" /></p>
<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_5_2.png" /></p>
<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_5_3.png" /></p>
<h3 id="testing-the-agent-in-a-tournament">Testing the agent in a tournament</h3>
<p>You can also run a complete tournament evaluating our agent against some other agents using <code>anl2025_tournament</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">anl2025</span><span class="w"> </span><span class="kn">import</span> <span class="n">anl2025_tournament</span><span class="p">,</span> <span class="n">Boulware2025</span><span class="p">,</span> <span class="n">Linear2025</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">anl2025_tournament</span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="n">scenarios</span><span class="o">=</span><span class="p">[</span><span class="n">make_multideal_scenario</span><span class="p">(</span><span class="n">nedges</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">competitors</span><span class="o">=</span><span class="p">(</span><span class="n">MyRandom2025</span><span class="p">,</span> <span class="n">Boulware2025</span><span class="p">,</span> <span class="n">Linear2025</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">)</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Output()
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>

<div class="language-text highlight"><pre><span></span><code>Output()
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>

<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Note that within a Jupyter notebook, you must pass n_jobs=-1 to run the whole tournament in the same process as the jupyter notebook itself. If this is not done, your class `MyRandom2025` will not  be found.
</span></code></pre></div>
<p>As expected, our random negotiator is worse than both builtin options.</p>
<p>We can get more information by analyzing the <code>scores</code> member which keeps track of individual scores of each negotiator in each sceanrio:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">final_scores</span><span class="p">)</span>
</span></code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'Boulware2025'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14.404889350168615</span>, <span style="color: #008000; text-decoration-color: #008000">'__main__.MyRandom2025'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.703482082422124</span>, <span style="color: #008000; text-decoration-color: #008000">'Linear2025'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9.841451716763187</span><span style="font-weight: bold">}</span>
</pre>

<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">scores</span><span class="p">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1"># Filter data for the two cases (center and edge)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">center_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;agent&#39;</span><span class="p">)[</span><span class="s1">&#39;utility&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">edge_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;agent&#39;</span><span class="p">)[</span><span class="s1">&#39;utility&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="n">ax1</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">center_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">center_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Negotiator Type&#39;</span><span class="p">)</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Utility&#39;</span><span class="p">)</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Center&#39;</span><span class="p">)</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="c1"># Box plot for index != 0</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="n">ax2</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Negotiator Type&#39;</span><span class="p">)</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Utility&#39;</span><span class="p">)</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Edge&#39;</span><span class="p">)</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="c1"># Rotate x-axis labels for both subplots</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_11_0.png" /></p>
<p>For this run, it is clear that the boulware negotiator is much better than the linear and our random negotiators when running in the center but (maybe) surprisingly, the linear agent is slightly better than the boulware agent when running as an edge.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>By default, scores as center are assigned `n. edges` times the weight of scores as edges because the agent runs almost this number of times as an edge for each time it runs as a center. This weight can be controlled using the `center_multiplier` and the `edge_multiplier`. The organization committee of ANL 2025 keeps the right to change these weights in the finals.
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">scores</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># Filter data for the two cases (center and edge)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">center_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;agent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="n">edge_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;agent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">center_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">center_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Negotiator Type&#39;</span><span class="p">)</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Utility&#39;</span><span class="p">)</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Center&#39;</span><span class="p">)</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="c1"># Box plot for index != 0</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">edge_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Negotiator Type&#39;</span><span class="p">)</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Utility&#39;</span><span class="p">)</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Edge&#39;</span><span class="p">)</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="c1"># Rotate x-axis labels for both subplots</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="png" src="../tutorial_develop_files/tutorial_develop_13_0.png" /></p>
<h2 id="types-of-multideal-scenarios-in-anl-2025">Types of multideal scenarios in ANL 2025</h2>
<h2 id="available-helpers">Available helpers</h2>
<p>Our negotiator was not so good but it exemplifies the simplest method for developing a negotiator for ANL 2025. For more information refer to <a href="https://negmas.readthedocs.io">NegMAS Documentation</a>. You develop your agent, as explained above, by implementing the <code>propose()</code> and <code>respond()</code> methods of your class.</p>
<p>Under the hood, every <code>ANL2025Negotiator</code> is an <a href="https://negmas.readthedocs.io/en/latest/api/negmas.sao.SAOController.html">SAOController</a> which is the class ressponsible for handling multiple negotiations at once in NegMAS for the Stacked Alternating Offers Protocol. An <code>SAOController</code> is a subclass of  <a href="https://negmas.readthedocs.io/en/latest/api/negmas.negotiators.Controller.html">Controller</a> which is responsible of handing multiple negotiations for any protocol in <a href="https://negmas.readthedocs.io">NegMAS</a>.</p>
<p>You can use any of the properties and methods provided by these classes in your development. The following sections describe some of the most important</p>
<h3 id="parameters-of-propose-and-respond">Parameters of propose and respond</h3>
<p>Whenever your negotiator is called by the protocol, it receives the <code>negotiator_id</code> which is a unique ID for each negotiation thread and the <code>state</code> of this negotiation (an <a href="https://negmas.readthedocs.io/en/latest/api/negmas.sao.SAOState.html#saostate">SAOState</a>).</p>
<h3 id="the-acceptancd-strategy-response">The acceptancd  strategy (response)</h3>
<h3 id="the-bidding-offering-strategy-propose">The bidding (offering) strategy (propose)</h3>
<p>This method, receives an <a href="https://negmas.readthedocs.io/en/latest/api/negmas.sao.SAOState.html">SAOState</a> which represents the current <code>state</code> of the negotiation. The most important members of this state object are <code>current_offer</code> which gives the current offer from the partner (or <code>None</code> if this is the beginning of the negotiation) and <code>relative_time</code> which gives the relative time of the negotiation ranging between <code>0</code> and <code>1</code>.</p>
<p>It should return an <a href="https://negmas.readthedocs.io/en/latest/api/negmas.sao.SAOResponse.html">SAOResponse</a> represeting the agent's <code>response</code> which consists of two parts:</p>
<ol>
<li>A <a href="https://negmas.readthedocs.io/en/latest/api/negmas.gb.ResponseType.html">ResponseType</a> with the following allowed values:<ul>
<li><code>ResponseType.ACCEPT_OFFER</code>, accepts the current offer (pass the current offer as the second member of the response).</li>
<li><code>ResponseType.REJECT_OFFER</code>, rejects the current offer (pass you counter-offer as the second member of the response).</li>
<li><code>ResponseType.END_NEGOTIATION</code>, ends the negotiation immediately (pass <code>None</code> as the second member of the response).</li>
</ul>
</li>
<li>A counter offer (in case of rejection), the received offer (in case of acceptance) or <code>None</code> if ending the negotiation.</li>
</ol>
<h3 id="properties-available-from-the-undelying-controller">Properties available from the undelying Controller</h3>
<h3 id="properties-and-methods-available-through-the-nmi">Properties and methods available through the NMI</h3>
<p>The negotiator can use the following objects to help it implement its strategy:</p>
<ul>
<li><code>self.nmi</code> A <a href="https://negmas.readthedocs.io/en/latest/api/negmas.sao.SAONMI.html">SAONMI</a> that gives you access to all the settings of this negotiation and provide some simple helpers:<ul>
<li><code>n_steps</code>, <code>time_limit</code> The number of rounds and seconds allowed for this negotiation (<code>None</code> means no limit).</li>
<li><code>random_outcomes(n)</code> Samples <code>n</code> random outcomes from this negotiation.</li>
<li><code>outcome_space</code> The <a href="https://negmas.readthedocs.io/en/latest/api/negmas.outcomes.OutcomeSpace.html">OutcomeSpace</a> of the negotiation which represent all possible agreements. In ANL 2024, this will always be of type <a href="https://negmas.readthedocs.io/en/latest/api/negmas.outcomes.DiscreteCartesianOutcomeSpace.html">DiscreteCartesianOutcomeSpace</a> with a single issue.</li>
<li><code>discrete_outcomes()</code> A generator of all outcomes in the outcome space.</li>
<li><code>log_info()</code> Logs structured information for this negotiator that can be checked in the logs later (Similarily there are <code>log_error</code>, <code>log_warning</code>, <code>log_debug</code>).</li>
</ul>
</li>
</ul>
<h3 id="tools-available-through-the-utility-function">Tools available through the utility function</h3>
<ul>
<li><code>self.ufun</code> A <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.LinearAdditiveUtilityFunction.html#negmas.preferences.LinearAdditiveUtilityFunction">LinearAdditiveUtilityFunction</a> representing the agent's own utility function. This object provides some helpful functionality including:</li>
<li><code>self.ufun.is_better(a, b)</code> Tests if outcome <code>a</code> is better than <code>b</code> (use <code>None</code> for disagreement). Similarily we have, <code>is_worse</code>, <code>is_not_worse</code> and <code>is_not_better</code>.</li>
<li><code>self.ufun.reserved_value</code> Your negotiator's reserved/reservation value (between 0 and 1). You can access this also as <code>self.ufun(None)</code>.</li>
<li><code>self.ufun(w)</code> Returns the utility value of the outcome <code>w</code>. It is recommended to cast this value to float (i.e. <code>float(self.ufun(w)</code>) to support probabilistic utility functions.</li>
<li><code>self.outcome_space</code> The <a href="https://negmas.readthedocs.io/en/latest/api/negmas.outcomes.OutcomeSpace.html">OutcomeSpace</a> of the negotiation which represent all possible agreements. In ANL 2024, this will always be of type <a href="https://negmas.readthedocs.io/en/latest/api/negmas.outcomes.DiscreteCartesianOutcomeSpace.html">DiscreteCartesianOutcomeSpace</a> with a single issue.</li>
<li><code>self.ufun.invert()</code> Returns and caches an <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.InverseUFun.html#negmas.preferences.InverseUFun">InverseUtilityFunction</a> object which can be used to find outcomes given their utilities. The most important services provided by the InverseUtilityFunction returned are:<ul>
<li><code>minmax()</code> returns the minimum and maximum values of the ufun (will always be (0, 1) approximately in ANL 2024).</li>
<li><code>best()</code>, <code>worst()</code> returns the best (worst) outcomes.</li>
<li><code>one_in()</code>, <code>some_in()</code> returns one (or some) outcomes within the given range of utilities.</li>
<li><code>next_better()</code>, <code>next_worse()</code> returns the next outcome descendingly (ascendingly) in utility value.</li>
</ul>
</li>
<li><code>self.opponent_ufun</code> A <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.LinearAdditiveUtilityFunction.html#negmas.preferences.LinearAdditiveUtilityFunction">LinearAdditiveUtilityFunction</a> representing the <strong>opponent's</strong> utility function. You can access this also as <code>self.private_info["opponent_ufun"]</code>. This utility function will have a zero reserved value independent of the opponent's true reserved value. You can actually set the reserved value on this object to your best estimate. All ufun funcationality is available in this object.</li>
</ul>
<p>Other than these objects, your negotiator can access any of the analytic facilities available in NegMAS. For example, you can calculate the <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.pareto_frontier.html">pareto_frontier</a>, <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.nash_points.html">Nash Bargaining Soluion</a>, <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.kalai_points.html">Kalai Bargaining Solution</a>, <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.max_welfare_points.html">points with maximum wellfare</a>, etc. You can check the implementation of the <a href="https://github.com/yasserfarouk/anl/blob/main/src/anl/anl2024/negotiators/builtins/nash_seeker.py">NashSeeker</a> agent for examples of using these facilities.</p>
<h2 id="other-callbacks">Other Callbacks</h2>
<p>Other than implementing the <code>propose()</code> and <code>respond()</code> methods, you can optionally implement one or more of the following callbacks to initialize your agent:</p>
<ul>
<li>
<p><code>init()</code> This is called after all the negotiation threads are initialized but before any of them are started. You can use it to initialize your agent while having access to all the tools described above</p>
</li>
<li>
<p><code>on_negotiation_start(state: SAOState)</code> This <a href="https://negmas.readthedocs.io/en/latest/api/negmas.negotiators.EvaluatorNegotiator.html#negmas.negotiators.EvaluatorNegotiator.on_negotiation_start">callback</a> is called once per negotiation after the ufuns are set but before any offers are exchanged.</p>
</li>
<li><code>on_preferences_changed(changes)</code> This <a href="https://negmas.readthedocs.io/en/latest/api/negmas.negotiators.EvaluatorNegotiator.html#negmas.negotiators.EvaluatorNegotiator.on_preferences_changed">callback</a> is called <strong>whenever</strong> your negotiator's ufun is changed. This will happen at the beginning of each negotiation but it can also happen again if the ufun is changed <strong>while the negotiation is running</strong>. In ANL 2024, ufuns never change during the negotiation so this callback is equivalent to <code>on_negotiation_start()</code> but for future proofness, you should use this callback for any initialization instead to guarantee that this initialization will be re-run in cases of changing utility function.</li>
</ul>
<h2 id="understanding-our-random-negotiator">Understanding our random negotiator</h2>
<p>Now we can analyze the simple random negotiator we developed earlier.</p>
<ul>
<li>Firstly, we find the current offer that we need to respond to:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">offer</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_offer</span>
</span></code></pre></div></li>
<li><strong>Acceptance Strategy</strong> We then accept this offer if three conditions are satisfied:</li>
<li>The offer is not <code>None</code> which means that we are not starting the negotiation just now:</li>
<li>The offer is not worse than disagreement. This prevents us from accepting irrational outcomes.</li>
<li>A random number we generated is less than 0.25. This means we accept rational offers with probability 25%.
    <div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">if</span> <span class="n">offer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="o">.</span><span class="n">is_not_worse</span><span class="p">(</span><span class="n">offer</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="k">return</span> <span class="n">SAOResponse</span><span class="p">(</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">ACCEPT_OFFER</span><span class="p">,</span> <span class="n">offer</span><span class="p">)</span>
</span></code></pre></div></li>
<li><strong>Offering Strategy</strong> If we decided not to accept the offer, we simply generate a single random outcome and offer it:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">return</span> <span class="n">SAOResponse</span><span class="p">(</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">REJECT_OFFER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmi</span><span class="o">.</span><span class="n">random_outcomes</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span></code></pre></div></li>
</ul>
<p>This negotiator did not use the fact that we know the opponent utility function up to reserved value. It did not even use the fact that we know our <em>own</em> utility function. As expected, it did not get a good score. Let's develop a simple yet more meaningful agent that uses both of these pieces of information.</p>
<p>Can you now see why is this negotiator is getting negative advantages sometimes? We were careful in our acceptance strategy but not in our <em>offering strategy</em>. There is nothing in our code that prevents our negotiator from offering irrational outcomes (i.e. outcomes worse than disagreement for itself) and sometimes the opponent will just accept those. Can you fix this?</p>
<h2 id="a-more-meaningful-negotiator">A more meaningful negotiator</h2>
<p>How can we use knowledge of our own and our opponent's utility functions (up to reserved value for them)? Here is one possibility:</p>
<ul>
<li><strong>Acceptance Strategy</strong> We accept offers that have a utility above some <em>aspiration</em> level. This aspiration level starts very high (1.0) and goes monotoncially down but never under the reserved value which is reached when the relative time is 1.0 (i.e. by the end of the negotiation). This is implemented in <code>is_acceptable()</code> below.</li>
<li>
<p><strong>Opponent Modeling</strong> We estimate the opponent reserved value under the assumption that they are using a monotonically decreasing curve to select a utility value and offer an outcome around it. This is implemented in <code>update_reserved_value()</code> below.</p>
</li>
<li>
<p><strong>Bidding Strategy</strong> Once we have an estimate of their reserved value, we can then find out all outcomes that are rational for both we and them. We can then check the relative time of the negotiation and offer outcomes by conceding over this list of rational outcomes. This is implemented in the <code>generate_offer()</code> method below.</p>
</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">anl2024_tournament</span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="n">n_scenarios</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nologs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">njobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">competitors</span><span class="o">=</span><span class="p">[</span><span class="n">MyRandom2025</span><span class="p">,</span> <span class="n">SimpleRVFitter</span><span class="p">,</span> <span class="n">Boulware</span><span class="p">,</span> <span class="n">Conceder</span><span class="p">]</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="p">)</span><span class="o">.</span><span class="n">final_scores</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>---------------------------------------------------------------------------

NameError                                 Traceback (most recent call last)

Cell In[10], line 1
----&gt; 1 anl2024_tournament(
      2     n_scenarios=1, n_repetitions=3, nologs=True, njobs=-1,
      3     competitors=[MyRandom2025, SimpleRVFitter, Boulware, Conceder]
      4 ).final_scores


NameError: name &#39;anl2024_tournament&#39; is not defined
</code></pre></div>
<p>Much better :-)</p>
<p>Let's see how each part of this negotiator works and how they fit together.</p>
<h3 id="construction">Construction</h3>
<p>The first method of the negotiator to be called is the <code>__init__</code> method which is called when the negotiator is created <strong>usually before the ufun is set</strong>. You can use this method to construct the negotiator setting initial values for any variables you need to run your agent.</p>
<p>An important thing to note here is that your negotiator <strong>must</strong> pass any parameters it does not use to its parent to make sure the object is constructed correctly. This is how we implement this in our <code>SimpleRVFitter</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div>
<p>We then set the variables we need for our negotiator:</p>
<ul>
<li><code>self.e</code> stores the exponent of the concession curve we will be use (more on that later).</li>
<li><code>self.opponent_times</code>, <code>self.opponent_utilities</code> keep track of the times the opponent offers and its own utility of its offers. We will use that to estimate the opponent's reserved value using simple curve fitting in <code>update_reserved_values()</code>.</li>
<li><code>self._past_oppnent_rv = 0.0</code> We start assuming that the opponent has zero reserved value. This is an optimistic assumption because it means that anything rational for us is rational for the opponent so we have more negotiation power.</li>
<li><code>self._rational</code> This is where we will store the list of rational outcomes to concede over. For each outcome we will store our utility, opponent utility and the outcome itself (in that order).</li>
</ul>
<h3 id="overall-algorithm">Overall Algorithm</h3>
<p>The overall algorithm is implemented --- as usual --- in the <code>__call__()</code> method. This is the complete algorithm:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update_reserved_value</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">current_offer</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">relative_time</span><span class="p">)</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptable</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">current_offer</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">relative_time</span><span class="p">):</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        <span class="k">return</span> <span class="n">SAOResponse</span><span class="p">(</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">ACCEPT_OFFER</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">current_offer</span><span class="p">)</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="k">return</span> <span class="n">SAOResponse</span><span class="p">(</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">REJECT_OFFER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_offer</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">relative_time</span><span class="p">))</span>
</span></code></pre></div>
<p>We start by updating our estimate of the reserved value of the opponent using <code>update_reserved_value()</code>. We then call the acceptance strategy <code>is_acceptable()</code> to check whether the current offer should be accepted. If the current offer is not acceptable, we call the bidding strategy <code>generate_offer()</code> to generate a new offer which we return as our counter-offer. Simple!!</p>
<h3 id="opponent-modeling-estimating-reserved-value">Opponent Modeling (Estimating Reserved Value)</h3>
<p>The first step is in our algorithm is to update our estimate of the opponent's reserved value. This is done in three simple steps:</p>
<ol>
<li>If we have not offer from the opponent, there is nothing to do. Just return:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">if</span> <span class="n">offer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>     <span class="k">return</span>
</span></code></pre></div></li>
<li>We append the time and opponent's utility to our running list of opponent offer utilities:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">opponent_utilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opponent_ufun</span><span class="p">(</span><span class="n">offer</span><span class="p">)))</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">opponent_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relative_time</span><span class="p">)</span>
</span></code></pre></div></li>
<li>
<p>We apply a simple <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html">curve fitting</a> algorithm from <a href="https://scipy.org">scipy</a> to estimate the opponent's reserved value (and its concession exponent but we are not going to use that):</p>
<ul>
<li>We set the bounds of the reserved value to be between zero (minimum possible value) and the minimum utility the opponent ever offered. This assumes that the opponent only offers rational outcomes for itself. The bounds for the concession curve are set to (0.2, 5.0) which is the usual range of exponents used by time-based strategies.
  <div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opponent_utilities</span><span class="p">)))</span>
</span></code></pre></div></li>
<li>We then just apply curve fitting while keeping the old estimate. We keep the old estimate to check whether there is enough change to warrent reevaluation of the rational outcome sets in our offering strategy. We ignore any errors keeping the old estimate in that case.</li>
</ul>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">optimal_vals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">rv</span><span class="p">:</span> <span class="n">aspiration_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opponent_utilities</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">opponent_times</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opponent_utilities</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="p">)</span>
</span></code></pre></div>
  Note that we just pass <code>self.opponent_utilities[0]</code> as the maximum for the concession curve because we know that this is the utility of the first offer from the opponent.</p>
<ul>
<li>Finally, we update the opponent reserved value with our new estimate keeping the latest value for later:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">_past_oppnent_rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opponent_ufun</span><span class="o">.</span><span class="n">reserved_value</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">opponent_ufun</span><span class="o">.</span><span class="n">reserved_value</span> <span class="o">=</span> <span class="n">optimal_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></code></pre></div></li>
</ul>
</li>
</ol>
<h3 id="acceptance-strategy">Acceptance Strategy</h3>
<p>Our acceptance strategy is implemented in <code>is_acceptable()</code> and consists of the following steps:</p>
<ol>
<li>Reject if no offer is found (i.e. we are starting the negotiation now):
   <div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">if</span> <span class="n">offer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div></li>
<li>Find our current aspiration level which starts at 1.0 (inidicating we will only accept our best offer in the first step) ending at our reserved value (indicating that we are willing to accept any rational outcome by the end of the negotiation). Use the exponent we stored during construction.
   <div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">asp</span> <span class="o">=</span> <span class="n">aspiration_function</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">relative_time</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="o">.</span><span class="n">reserved_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div></li>
<li>Accept the offer iff its utility is higher than the aspiration level:
    <div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="p">(</span><span class="n">offer</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">asp</span>
</span></code></pre></div>
Note that this acceptance strategy does not use the estimated opponent reserved value (or the opponent's ufun) in any way.</li>
</ol>
<h3 id="bidding-strategy">Bidding Strategy</h3>
<p>Now that we have updated our estimate of the opponent reserved value and decided not to accept their offer, we have to generate our own offer which the job of the bidding strategy implementedin <code>generate_offer()</code>. This is done in three steps as well:</p>
<ol>
<li>
<p>If the difference between the current and last estimate of the opponent reserved value is large enough, we create the rational outcome list.</p>
<ul>
<li>This test is implemented by:
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rational</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opponent_ufun</span><span class="o">.</span><span class="n">reserved_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_past_oppnent_rv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-3</span>
</span></code></pre></div></li>
<li>We then create of all outcomes prepending them with our and opponent's utility values:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">[</span> <span class="p">(</span><span class="n">my_util</span><span class="p">,</span> <span class="n">opp_util</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmi</span><span class="o">.</span><span class="n">outcome_space</span><span class="o">.</span><span class="n">enumerate_or_sample</span><span class="p">(</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>      <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_cardinality</span><span class="o">=</span><span class="mi">100_000</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>  <span class="p">)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>  <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>      <span class="p">(</span><span class="n">my_util</span> <span class="o">:=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="p">(</span><span class="n">_</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="o">.</span><span class="n">reserved_value</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>      <span class="ow">and</span> <span class="p">(</span><span class="n">opp_util</span> <span class="o">:=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opponent_ufun</span><span class="p">(</span><span class="n">_</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">opponent_ufun</span><span class="o">.</span><span class="n">reserved_value</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="p">)]</span>
</span></code></pre></div></li>
<li>Finally, we sort this list. Because each element is a tuple, the list will be sorted ascendingly by our utility with equal values sorted ascendingly by the opponent utility.
  <div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">_rational</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>If there are no rational outcomes (e.g. our estimate of the opponent rv is very wrong), then just revert to offering our top offer
   <div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rational</span><span class="p">:</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ufun</span><span class="o">.</span><span class="n">best</span><span class="p">()</span>
</span></code></pre></div></p>
</li>
<li>If we have a rational set, we calculate an aspiration level that starts at 1 and ends at 0 (note that we do not need to end at the reserved value because all outcomes in <code>self._rational</code> are already no worse than disagreement. We then calculate the outcome that is at the current aspiration level from the end of the rational outcome list and offer it:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">asp</span> <span class="o">=</span> <span class="n">aspiration_function</span><span class="p">(</span><span class="n">relative_time</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">max_rational</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rational</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">indx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_rational</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">asp</span> <span class="o">*</span> <span class="n">max_rational</span><span class="p">)))</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rational</span><span class="p">[</span><span class="n">indx</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="k">return</span> <span class="n">outcome</span>
</span></code></pre></div></li>
</ol>
<h3 id="running-a-single-negotiation">Running a single negotiation</h3>
<p>What if we now want to see what happens in a single negotiation using our shiny new negotiator?
We first need a scenario to define the outcome space and ufuns. We can then add negotiators to it and run it. Let's see an example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">negmas.sao</span><span class="w"> </span><span class="kn">import</span> <span class="n">SAOMechanism</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">anl.anl2024.runner</span><span class="w"> </span><span class="kn">import</span> <span class="n">mixed_scenarios</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">anl.anl2024.negotiators.builtins</span><span class="w"> </span><span class="kn">import</span> <span class="n">Linear</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="c1"># create a scenario</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="n">s</span> <span class="o">=</span> <span class="n">mixed_scenarios</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1"># copy ufuns and set rv to 0 in the copies</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="n">ufuns0</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">ufuns</span><span class="p">]</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ufuns0</span><span class="p">:</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    <span class="n">u</span><span class="o">.</span><span class="n">reserved_value</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="c1"># create the negotiation mechanism</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="n">session</span> <span class="o">=</span> <span class="n">SAOMechanism</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">outcome_space</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">outcome_space</span><span class="p">)</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="c1"># add negotiators. Remember to pass the opponent_ufun in private_info</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>    <span class="n">SimpleRVFitter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;SimpleRVFitter&quot;</span><span class="p">,</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>                   <span class="n">private_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opponent_ufun</span><span class="o">=</span><span class="n">ufuns0</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>    <span class="p">,</span> <span class="n">ufun</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">ufuns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="p">)</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Linear</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Linear&quot;</span><span class="p">),</span> <span class="n">ufun</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">ufuns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="c1"># run the negotiation and plot the results</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="n">session</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p>Notice how in the second half of the negotiation, the SimpleRVFitter is only offering outcomes that are rational for both negotiators (can you see that in the left-side plot? can you see it in the top right-side plot?). This means that the curve fitting approach is working OK here. The opponent is a time-based strategy in this case though.</p>
<p>What happens if it was not? Let's try it against the builtin RVFitter for example</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">anl.anl2024.negotiators</span><span class="w"> </span><span class="kn">import</span> <span class="n">RVFitter</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1"># create the negotiation mechanism</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">session</span> <span class="o">=</span> <span class="n">SAOMechanism</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">outcome_space</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">outcome_space</span><span class="p">)</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="c1"># add negotiators. Remember to pass the opponent_ufun in private_info</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="n">SimpleRVFitter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;SimpleRVFitter&quot;</span><span class="p">,</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>                   <span class="n">private_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opponent_ufun</span><span class="o">=</span><span class="n">ufuns0</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>    <span class="p">,</span> <span class="n">ufun</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">ufuns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="p">)</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>    <span class="n">RVFitter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;RVFitter&quot;</span><span class="p">,</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>                   <span class="n">private_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opponent_ufun</span><span class="o">=</span><span class="n">ufuns0</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>    <span class="p">,</span> <span class="n">ufun</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">ufuns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="p">)</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="c1"># run the negotiation and plot the results</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="n">session</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p>This time, our simple RV fitter could not really learn the opponent reserved value effectively. We can see that from the fact that it kept offering outcomes that are irrational for the opponent almost until the end of the negotiation.</p>
<p>The builtin <code>RVFitter</code> seems better in this case. It took longer but it seems to only offer rational outcomes for its opponent (our SimpleRVFitter) after around 60% of the available negotiation time.</p>
<h2 id="other-examples">Other Examples</h2>
<p>The ANL package comes with some example negotiators. These are not designed to be stong but to showcase how to use some of the features provided by the platform.</p>
<ul>
<li><a href="https://github.com/yasserfarouk/anl/blob/main/src/anl/anl2024/negotiators/builtins/micro.py">MiCRO</a> A strong baseline behavioral negotiation strategy developed by de Jonge, Dave in "An Analysis of the Linear Bilateral ANAC Domains Using the MiCRO Benchmark Strategy.", ICJAI 2022. This strategy assumes no knowledge of the opponent utility function and is implemented from scratch to showcase the following:<ul>
<li>Using <code>on_preferences_changed</code> for initialization.</li>
<li>Using <a href="https://negmas.readthedocs.io/en/latest/api/negmas.preferences.PresortingInverseUtilityFunction.html">PresortingInverseUtilityFunction</a> for inverting a utility function.</li>
</ul>
</li>
<li><a href="https://github.com/yasserfarouk/anl/blob/main/src/anl/anl2024/negotiators/builtins/nash_seeker.py">NashSeeker</a> A naive strategy that simply sets the opponent reserved value to a fixed value and then uses helpers from NegMAS to find the <a href="https://en.wikipedia.org/wiki/Cooperative_bargaining">Nash Bargaining Solution</a> and use it for deciding what to offer. This showcases:<ul>
<li>Using NegMAS helpers to calculate the pareto-frontier and the Nash Bargaining Solution</li>
</ul>
</li>
<li><a href="https://github.com/yasserfarouk/anl/blob/main/src/anl/anl2024/negotiators/builtins/rv_fitter.py">RVFitter</a> A strategy very similar to the one we implemented earlier as <code>SimpleRVFitter</code>. Instead of trying to estiamte the opponent reserved value from the first step, this strategy waits until it collects few offers before attempting the etimation. This showcases:<ul>
<li>Setting the opponent reserved value based on our best estimate.</li>
<li>A simple way to use this estimate for our bidding strategy.</li>
<li>Using <strong>logging</strong>. Logs can be saved using <code>self.nmi.log_info(dict(my_key=my_value))</code> and found under the logs folder.</li>
</ul>
</li>
<li><a href="https://github.com/yasserfarouk/anl/blob/main/src/anl/anl2024/negotiators/builtins/wrappers.py">Boulware, Conceder, Linear</a> Time-based strategies that are implemented by just setting construction parameters of an existing NegMAS negotiator</li>
<li><a href="https://github.com/yasserfarouk/anl/blob/main/src/anl/anl2024/negotiators/builtins/wrappers.py">StochasticBoulware, StochasticConceder, StochasticLinear</a> Stochastic versions of the three time-based strategies above implemented by just setting construction parameters of an existing NegMAS negotiator</li>
<li><a href="https://github.com/yasserfarouk/anl/blob/main/src/anl/anl2024/negotiators/builtins/wrappers.py">NaiveTitForTat</a> A simple behavioral strategy implemented by just inheriting from an existing NegMAS negotiator.</li>
</ul>
<h4 id="note-about-running-tournaments">Note about running tournaments</h4>
<ul>
<li>When running a tournament using <code>anl2024_tournament</code> inside a Jupyter Notebook, you <strong>must</strong> pass <code>njobs=-1</code> to force serial execution of negotiations. This is required because the multiprocessing library used by NegMAS does not play nicely with Jupyter Notebooks. If you run the tournament using the same method from a <code>.py</code> python script file, you can omit this argument to run a tournament using all available cores.</li>
<li>When you pass <code>nologs=True</code>, no logs are stored for this tournament. If you omit this argument, a log will be created under <code>~/negmas/anl2024/tournaments</code> which can be visualized using the ANL visualizer by running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>anlv<span class="w"> </span>show
</span></code></pre></div>
<p><a href="/anl2025/tutorials/notebooks/tutorial_develop.ipynb">Download Notebook</a></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>